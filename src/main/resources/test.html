<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <h1>Registration</h1>
    <div>
        <label for="username-id">User</label><input id="username-id" type="text" placeholder="Username">
        <label for="password-id">Password</label><input id="password-id" type="password" placeholder="Password">
    </div>
    <div>
        <label for="email-id"></label>Email<input id="email-id" type="email" placeholder="Email">
        <label for="gender-id">Gender</label><select id="gender-id"></select>
    </div>
    <div>
        <label for="terms-id">I agree to the terms of service:</label><input id="terms-id" type="checkbox">
    </div>
    <div>
        <label id="feedback-id">?</label>
    </div>
    <div>
        <button id="register-id">Register</button>
    </div>
</body>
<script src="backend-binder.js"></script>
<script>
        start('ws://localhost:8080/websocket', ( session, vm ) => {
            const props = vm.state[PROPS];
            // We turn the view model json into a pretty string
            const viewModelPrettyString = JSON.stringify(props, null, 4);
            console.log("loadView... "+viewModelPrettyString);
            // Now let's load the view model into the view

            // We attach a simple username password form with a terms of service checkbox
            const username = document.getElementById("username-id");
            username.value = props.username.value;
            username.onkeyup = (event) => { vm.set("username", event.target.value); };
            vm.get('username', txt => { username.value = txt; });

            const password = document.getElementById("password-id");
            password.value = props.password.value;
            password.onkeyup = (event) => { vm.set("password", event.target.value); };
            vm.get('password', txt => { password.value = txt; });

            const email = document.getElementById("email-id");
            email.value = props.email.value;
            email.onkeyup = (event) => { vm.set("email", event.target.value); };
            vm.get('email', txt => { email.value = txt; });

            // now the gender drop down:
            const gender = document.getElementById("gender-id");
            const genders = props.gender.type.states;
            for (let i = 0; i < genders.length; i++) {
                const option = document.createElement("option");
                option.value = genders[i];
                option.text = genders[i];
                gender.appendChild(option);
            }
            gender.onchange = (event) => { vm.set("gender", event.target.value) };
            gender.value = props.gender.value
            vm.get("gender", txt => gender.value = txt);

            const termsOfService = document.getElementById("terms-id");
            termsOfService.checked = props.termsAccepted.value;
            termsOfService.onchange = (event) => { vm.set("termsAccepted", event.target.checked); };
            vm.get('termsOfService', txt => { termsOfService.checked = txt; });

            const feedback = document.getElementById("feedback-id");
            // We replace \n with br tags
            feedback.innerHTML = props.feedback.value.replace(/\\n/g, "<br>");
            vm.get('feedback', txt => { feedback.innerHTML = txt.replace(/\\n/g, "<br>"); });

            const register = document.getElementById("register-id");
            register.onclick = (event) => {
                vm.register()
            };

        });
    </script>
</html>