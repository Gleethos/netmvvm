<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div id = "application-content">

    </div>
</body>
<script src="MVVM_binding.js"></script>
<script>
        start(
            'ws://localhost:8080/websocket',
            (
                vm,    // The current view model
                vmSet, // Send a property change to the server, expects 2 arguments: propName, value
                vmGet, // For binding to properties, expects 2 parameters: the property name and the action to call when the property changes
                get    // For loading a new view model, expects 2 parameters: vmId and action
            )=>{
            const props = vm[PROPS];
            // We turn the view model json into a pretty string
            const viewModelPrettyString = JSON.stringify(props, null, 4);
            console.log("loadView... "+viewModelPrettyString);
            // Now let's load the view model into the view
            const applicationContent = document.getElementById("application-content");

            // We attach a simple username password form with a terms of service checkbox
            const username = document.createElement("input");
            username.type = "text";
            username.placeholder = "Username";
            username.value = props.username.value;
            username.onchange = (event) => { vmSet("username", event.target.value); };
            vmGet('username', txt => { username.value = txt; });
            applicationContent.appendChild(username);

            const password = document.createElement("input");
            password.type = "password";
            password.placeholder = "Password";
            password.value = props.password.value;
            password.onchange = (event) => { vmSet("password", event.target.value); };
            vmGet('password', txt => { password.value = txt; });
            applicationContent.appendChild(password);
            // break:
            applicationContent.appendChild(document.createElement("br"));

            const termsOfService = document.createElement("input");
            termsOfService.type = "checkbox";
            termsOfService.checked = props.termsAccepted.value;
            termsOfService.onchange = (event) => { vmSet("termsAccepted", event.target.checked); };
            vmGet('termsOfService', txt => { termsOfService.checked = txt; });
            applicationContent.appendChild(termsOfService);

            const termsOfServiceLabel = document.createElement("label");
            termsOfServiceLabel.innerHTML = "I agree to the terms of service";
            applicationContent.appendChild(termsOfServiceLabel);

            // break:
            applicationContent.appendChild(document.createElement("br"));
            applicationContent.appendChild(document.createElement("br"));

            const feedback = document.createElement("div");
            // We replace \n with br tags
            feedback.innerHTML = props.feedback.value.replace(/\\n/g, "<br>");
            vmGet('feedback', txt => { feedback.innerHTML = txt.replace(/\\n/g, "<br>"); });
            applicationContent.appendChild(feedback);
        });
    </script>
</html>